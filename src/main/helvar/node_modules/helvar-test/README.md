# Assignment

## Specification

Suppose that a nodejs package named 'helvar-test' (enclosed as helvar-test-1.0.0.tgz) is ready for integration test. The package reads a message from a JSON file then retrieves devices and saves them to redis database which is running as a docker container. Your task is to write integration tests in Python to verify that the devices in JSON file are stored at redis database correctly.

The message format in json file is defined as json schema (enclosed as schema.json) and an example of JSON file looks like:

```JSON
{
  "header": {
    "version": "1.0" // string
  },
  "payload": [ // array
    {
      "id": "1000", // string
      "info": "Device A" // string
    },
    {
      "id": "1001", // string
      "info": "Device B" // string
    }
  ]
}
```

The devices stored in redis (host='localhost', port=6379) can be accessed by *redis-py*, a redis python client. [This tutorial](https://www.bogotobogo.com/python/python_redis_with_python.php) demonstrates how to use it. Since redis is a key-value based database, thus the *key* for devices is 'helvar' and the *value* for devices is [hashes](https://redis.io/topics/data-types#hashes) which contain all devices. In hashes, each device is identified by its 'id'. Suppose that the above example JSON is used, some redis [hash commands](https://redis.io/commands#hash) can be used to check the devices:

```bash
# get all devices
127.0.0.1:6379> hgetall helvar
1) "1000"
2) "Device A"
3) "1001"
4) "Device B"
# get total number of devices
127.0.0.1:6379> hlen helvar
(integer) 2
# get device whose id is 1000
127.0.0.1:6379> hget helvar 1000
"Device A"
# get device whose id is 1001
127.0.0.1:6379> hget helvar 1001
"Device B"
# clear database
127.0.0.1:6379> del helvar
(integer) 1
```

## Requirements

- automated integration tests written in Python

- positive and negative test cases are provided

- source codes and documents are submitted

- automated setup/teardown is a plus

- performance test case (10k+ devices in JSON file) is a plus

## Guides to Perform Tests Manually

### Prerequisite

1. install nodejs LTS (8.x)

    - Ubuntu/Debian:

        ```bash
        curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
        sudo apt-get install -y nodejs
        ```

    - MacOS:

        Download macOS installer directly from [here](https://nodejs.org/dist/v8.12.0/node-v8.12.0.pkg)

    - Windows:

        Download windows installer directly from [here](https://nodejs.org/dist/v8.12.0/node-v8.12.0-x86.msi)

2. install docker

    - Ubuntu/Debian:

        ```bash
        curl -fsSL get.docker.com -o get-docker.sh
        sh get-docker.sh
        # For more instructions, see https://docs.docker.com/install/linux/docker-ce/ubuntu/
        ```

    - MacOS:

        Download macOS installer directly from [here](https://download.docker.com/mac/stable/Docker.dmg).
        For more information, see [this document](https://docs.docker.com/docker-for-mac/install/).

    - Windows:

        Download windows installer directly from [here](https://download.docker.com/win/stable/Docker%20for%20Windows%20Installer.exe).
        For more information, see [this document](https://docs.docker.com/docker-for-windows/install/).

### Setup Integration Test Environment (before running tests)

- Run Redis Database

    ```bash
    docker pull redis
    docker run -d --name redis -p 6379:6379 redis
    ```

- Install Package

    ```bash
    mkdir helvar
    cd helvar
    cp helvar-test-1.0.0.tgz .
    npm install helvar-test-1.0.0.tgz  # you can ignore the npm WARNs
    ```

### Teardown Integration Test Environment (after running test)

- Remove Package

    ```bash
    rm -fr helvar
    ```

- Terminate Redis Database

    ```bash
    docker stop redis
    docker rm redis
    docker rmi redis
    docker volume prune -f
    ```

### Run Tests

```bash
cd helvar
node_modules/.bin/helvar-test /absolute/path/to/test-data.json
```

After this, the devices can be verified at redis database by *redis-py*. For your debugging, 'helvar-test' will give error messages if something goes wrong. Remember that JSON file **MUST** be provided in an absolute path.
